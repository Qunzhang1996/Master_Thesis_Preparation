function runAutomation()
%
% Authors:       Alexander Wischnewski
%
% Description:
%   function used to run multiple parameter sets and store the results in the logs
%   parameters to be tested have to be adjusted in this script! it only serves as a basis for
%   modifications.
%

% specify the racetrack to run on
loadRaceline('Monteblanco2019_track'); 
% specify the time to simulate
tSim = 160;
% specify the runs to be tested as a cell array of cell arrays
% each run is structured like this
% runname, param1, value, param2, value, ...
params = {...
    {'SimTest_080_00', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.80, 'P_VDC_Dist_ax_mps2', 0, 'P_VDC_Dist_ay_mps2', 0}, ...
    {'SimTest_085_00', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.85, 'P_VDC_Dist_ax_mps2', 0, 'P_VDC_Dist_ay_mps2', 0}, ...
    {'SimTest_090_00', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.90, 'P_VDC_Dist_ax_mps2', 0, 'P_VDC_Dist_ay_mps2', 0}, ...
    {'SimTest_095_00', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.95, 'P_VDC_Dist_ax_mps2', 0, 'P_VDC_Dist_ay_mps2', 0}, ...
    {'SimTest_100_00', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.00, 'P_VDC_Dist_ax_mps2', 0, 'P_VDC_Dist_ay_mps2', 0}, ...
    {'SimTest_105_00', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.05, 'P_VDC_Dist_ax_mps2', 0, 'P_VDC_Dist_ay_mps2', 0}, ...
    {'SimTest_110_00', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.10, 'P_VDC_Dist_ax_mps2', 0, 'P_VDC_Dist_ay_mps2', 0}, ...
    {'SimTest_115_00', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.15, 'P_VDC_Dist_ax_mps2', 0, 'P_VDC_Dist_ay_mps2', 0}, ...
    {'SimTest_120_00', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.20, 'P_VDC_Dist_ax_mps2', 0, 'P_VDC_Dist_ay_mps2', 0}, ...
    {'SimTest_080_05', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.80, 'P_VDC_Dist_ax_mps2', 0.5, 'P_VDC_Dist_ay_mps2', 0.5}, ...
    {'SimTest_085_05', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.85, 'P_VDC_Dist_ax_mps2', 0.5, 'P_VDC_Dist_ay_mps2', 0.5}, ...
    {'SimTest_090_05', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.90, 'P_VDC_Dist_ax_mps2', 0.5, 'P_VDC_Dist_ay_mps2', 0.5}, ...
    {'SimTest_095_05', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.95, 'P_VDC_Dist_ax_mps2', 0.5, 'P_VDC_Dist_ay_mps2', 0.5}, ...
    {'SimTest_100_05', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.00, 'P_VDC_Dist_ax_mps2', 0.5, 'P_VDC_Dist_ay_mps2', 0.5}, ...
    {'SimTest_105_05', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.05, 'P_VDC_Dist_ax_mps2', 0.5, 'P_VDC_Dist_ay_mps2', 0.5}, ...
    {'SimTest_110_05', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.10, 'P_VDC_Dist_ax_mps2', 0.5, 'P_VDC_Dist_ay_mps2', 0.5}, ...
    {'SimTest_115_05', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.15, 'P_VDC_Dist_ax_mps2', 0.5, 'P_VDC_Dist_ay_mps2', 0.5}, ...
    {'SimTest_120_05', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.20, 'P_VDC_Dist_ax_mps2', 0.5, 'P_VDC_Dist_ay_mps2', 0.5}, ...
    {'SimTest_080_10', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.80, 'P_VDC_Dist_ax_mps2', 1, 'P_VDC_Dist_ay_mps2', 1}, ...
    {'SimTest_085_10', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.85, 'P_VDC_Dist_ax_mps2', 1, 'P_VDC_Dist_ay_mps2', 1}, ...
    {'SimTest_090_10', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.90, 'P_VDC_Dist_ax_mps2', 1, 'P_VDC_Dist_ay_mps2', 1}, ...
    {'SimTest_095_10', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.95, 'P_VDC_Dist_ax_mps2', 1, 'P_VDC_Dist_ay_mps2', 1}, ...
    {'SimTest_100_10', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.00, 'P_VDC_Dist_ax_mps2', 1, 'P_VDC_Dist_ay_mps2', 1}, ...
    {'SimTest_105_10', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.05, 'P_VDC_Dist_ax_mps2', 1, 'P_VDC_Dist_ay_mps2', 1}, ...
    {'SimTest_110_10', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.10, 'P_VDC_Dist_ax_mps2', 1, 'P_VDC_Dist_ay_mps2', 1}, ...
    {'SimTest_115_10', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.15, 'P_VDC_Dist_ax_mps2', 1, 'P_VDC_Dist_ay_mps2', 1}, ...
    {'SimTest_120_10', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.20, 'P_VDC_Dist_ax_mps2', 1, 'P_VDC_Dist_ay_mps2', 1}, ...
    {'SimTest_080_15', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.80, 'P_VDC_Dist_ax_mps2', 1.5, 'P_VDC_Dist_ay_mps2', 1.5}, ...
    {'SimTest_085_15', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.85, 'P_VDC_Dist_ax_mps2', 1.5, 'P_VDC_Dist_ay_mps2', 1.5}, ...
    {'SimTest_090_15', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.90, 'P_VDC_Dist_ax_mps2', 1.5, 'P_VDC_Dist_ay_mps2', 1.5}, ...
    {'SimTest_095_15', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.95, 'P_VDC_Dist_ax_mps2', 1.5, 'P_VDC_Dist_ay_mps2', 1.5}, ...
    {'SimTest_100_15', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.00, 'P_VDC_Dist_ax_mps2', 1.5, 'P_VDC_Dist_ay_mps2', 1.5}, ...
    {'SimTest_105_15', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.05, 'P_VDC_Dist_ax_mps2', 1.5, 'P_VDC_Dist_ay_mps2', 1.5}, ...
    {'SimTest_110_15', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.10, 'P_VDC_Dist_ax_mps2', 1.5, 'P_VDC_Dist_ay_mps2', 1.5}, ...
    {'SimTest_115_15', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.15, 'P_VDC_Dist_ax_mps2', 1.5, 'P_VDC_Dist_ay_mps2', 1.5}, ...
    {'SimTest_120_15', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.20, 'P_VDC_Dist_ax_mps2', 1.5, 'P_VDC_Dist_ay_mps2', 1.5}, ...
    {'SimTest_080_20', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.80, 'P_VDC_Dist_ax_mps2', 2, 'P_VDC_Dist_ay_mps2', 2}, ...
    {'SimTest_085_20', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.85, 'P_VDC_Dist_ax_mps2', 2, 'P_VDC_Dist_ay_mps2', 2}, ...
    {'SimTest_090_20', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.90, 'P_VDC_Dist_ax_mps2', 2, 'P_VDC_Dist_ay_mps2', 2}, ...
    {'SimTest_095_20', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.95, 'P_VDC_Dist_ax_mps2', 2, 'P_VDC_Dist_ay_mps2', 2}, ...
    {'SimTest_100_20', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.00, 'P_VDC_Dist_ax_mps2', 2, 'P_VDC_Dist_ay_mps2', 2}, ...
    {'SimTest_105_20', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.05, 'P_VDC_Dist_ax_mps2', 2, 'P_VDC_Dist_ay_mps2', 2}, ...
    {'SimTest_110_20', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.10, 'P_VDC_Dist_ax_mps2', 2, 'P_VDC_Dist_ay_mps2', 2}, ...
    {'SimTest_115_20', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.15, 'P_VDC_Dist_ax_mps2', 2, 'P_VDC_Dist_ay_mps2', 2}, ...
    {'SimTest_120_20', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.20, 'P_VDC_Dist_ax_mps2', 2, 'P_VDC_Dist_ay_mps2', 2}, ...
    {'SimTest_080_25', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.80, 'P_VDC_Dist_ax_mps2', 2.5, 'P_VDC_Dist_ay_mps2', 2.5}, ...
    {'SimTest_085_25', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.85, 'P_VDC_Dist_ax_mps2', 2.5, 'P_VDC_Dist_ay_mps2', 2.5}, ...
    {'SimTest_090_25', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.90, 'P_VDC_Dist_ax_mps2', 2.5, 'P_VDC_Dist_ay_mps2', 2.5}, ...
    {'SimTest_095_25', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 0.95, 'P_VDC_Dist_ax_mps2', 2.5, 'P_VDC_Dist_ay_mps2', 2.5}, ...
    {'SimTest_100_25', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.00, 'P_VDC_Dist_ax_mps2', 2.5, 'P_VDC_Dist_ay_mps2', 2.5}, ...
    {'SimTest_105_25', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.05, 'P_VDC_Dist_ax_mps2', 2.5, 'P_VDC_Dist_ay_mps2', 2.5}, ...
    {'SimTest_110_25', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.10, 'P_VDC_Dist_ax_mps2', 2.5, 'P_VDC_Dist_ay_mps2', 2.5}, ...
    {'SimTest_115_25', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.15, 'P_VDC_Dist_ax_mps2', 2.5, 'P_VDC_Dist_ay_mps2', 2.5}, ...
    {'SimTest_120_25', 'P_VDC_VirtualScaleFactor', 0.94, 'P_VDC_AccLimitsPlanner', 13.5*0.94^2, 'P_BrakeGain', 1.20, 'P_VDC_Dist_ax_mps2', 2.5, 'P_VDC_Dist_ay_mps2', 2.5}, ...
};

% disable warnings for better output readability
warning off;

% configure simulation model
DD = Simulink.data.dictionary.open('PassengerVehicle.sldd');
DataSect = getSection(DD,'Design Data');
DDentry = getEntry(DataSect, 'P_PassengerVehicleSimModel');
setValue(DDentry, 1);
DD.saveChanges();
close(DD);

% iterate over all parametersets given
for i = 1:1:length(params)
    % configure parameters
    DD = Simulink.data.dictionary.open('controller_dev.sldd');
    DataSect = getSection(DD, 'Design Data');
    % load parameter set
    parameter_set = params{i};
    disp(['Next parameter set is ' parameter_set{1} ' ...']);
    disp('Parameters to be simulated are: ');
    for k = 1:1:((length(parameter_set)-1)/2)
        disp([parameter_set{2+2*(k-1)} ': ' num2str(parameter_set{3+2*(k-1)})]);
        DDentry = getEntry(DataSect, parameter_set{2+2*(k-1)});
        entry_helper = getValue(DDentry);
        entry_helper.Value = parameter_set{3+2*(k-1)};
        setValue(DDentry, entry_helper);
    end
    DD.saveChanges();
    close(DD);
    disp('Start simulation ...');
    simOut = sim('controller_dev.slx', 'StopTime', num2str(tSim));
    logsout = simOut.get('logsout');
    convertSimLogs(logsout, parameter_set{1});
    disp('We are done with this run and getting ready for next! ');
end

% enable warnings again
warning on;
